---
// ThemeSwitcher.astro
import DropdownMenu from './DropdownMenu.astro';

const themeOptions = [
  { name: 'Sky', url: '#sky' },
  { name: 'Violet', url: '#violet' },
  { name: 'Emerald', url: '#emerald' },
  { name: 'Teal', url: '#teal' },
];
---

<div class="theme-switcher">
  <DropdownMenu
    name="Accent Color"
    links={themeOptions}
    showCaret={true}
    icon={false}
  />
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', (event) => {
    // Function to change the theme
    const changeTheme = (newTheme) => {
      // Array of valid accent colors
      const validThemes = ['sky', 'emerald', 'teal', 'violet'];

      // Get all classes from the root element
      const rootClasses = document.documentElement.className.split(/\s+/);

      // Remove the old theme class if it's a valid accent color
      rootClasses.forEach((cls) => {
        if (validThemes.includes(cls)) {
          document.documentElement.classList.remove(cls);
        }
      });

      // Add the new theme class if it's a valid accent color
      if (validThemes.includes(newTheme)) {
        document.documentElement.classList.add(newTheme);
        localStorage.setItem('themeSwitcher', newTheme);
      }
    };

    // Add event listeners to theme option links
    document
      .querySelectorAll('.theme-switcher .dropdown-content a')
      .forEach((link) => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const theme = e.target.getAttribute('href').substring(1); // Extract theme name from href
          changeTheme(theme);
        });
      });

    // Set the default theme based on stored preference or default to 'sky'
    const currentTheme = localStorage.getItem('themeSwitcher') || 'sky';
    changeTheme(currentTheme);
  });
</script>
